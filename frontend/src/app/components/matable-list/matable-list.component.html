<app-header></app-header>

<div class="container">
  <!-- Search Input -->
  <input
    type="text"
    placeholder="Search by name, description, or status"
    [(ngModel)]="searchTerm"
    (input)="onSearch(searchTerm)"
    class="form-control mt-3"
  />

  <!-- Form Component -->
  <app-matable-form *ngIf="isComponentVisible" (formSubmitted)="onFormSubmitted()"></app-matable-form>

  <!-- Table -->
  <div class="table-responsive">
    <div class="matable-list">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Status</th>
            <th>Tenant Code</th>
            <th>User ID</th>
            <th>Images</th>
            <th>Assign To</th>
            <th>Module</th>
            <th>Log Time</th>
            <th>Resolve Date</th>
            <th>Time Taken</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let matable of matables">
            <td data-label="Name">{{ matable.Name }}</td>
            <td data-label="Description">{{ matable.Description }}</td>
            <td data-label="Status">{{ matable.StatusName }}</td>
            <td data-label="Tenant Code">{{ matable.TenantCode }}</td>
            <td data-label="User ID">{{ matable.UserId }}</td>
            <td data-label="Images">
              <ng-container *ngIf="matable.ImagePaths?.length; else noImage">
                <img *ngFor="let img of matable.ImagePaths" [src]="img" alt="Image" style="max-width: 100px; margin: 2px;" />
              </ng-container>
              <ng-template #noImage>No image</ng-template>
            </td>
            <td data-label="Assign To">{{ matable.AssignTo }}</td>
            <td data-label="Module">{{ matable.Module }}</td>
            <td data-label="Log Time">{{ matable.LogTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
            <td data-label="Resolve Date">{{ matable.ResolveDate }}</td>
            <td data-label="Time Taken">{{ matable.TakenTime | durationFormat }}</td>
            <td data-label="Actions">
              <button class="btn btn-primary btn-sm" (click)="openEditModal(matable)">Edit</button>
              <button class="btn btn-secondary btn-sm" (click)="deleteMatable(matable.UserId)">Delete</button>
              <button class="btn btn-success btn-sm" (click)="onPrintMatable(matable.UserId)">Print</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Print Section -->
      <div *ngIf="printMatableData" id="obv_Print_Pick_Slip">
        <h2>Matable Details</h2>
        <p><strong>Name:</strong> {{ printMatableData.Name }}</p>
        <p><strong>Description:</strong> {{ printMatableData.Description }}</p>
        <p><strong>Status:</strong> {{ printMatableData.StatusName }}</p>
        <p><strong>Module:</strong> {{ printMatableData.Module }}</p>
        <p><strong>Assign To:</strong> {{ printMatableData.AssignTo }}</p>
        <p><strong>Tenant Code:</strong> {{ printMatableData.TenantCode }}</p>
        <p><strong>User ID:</strong> {{ printMatableData.UserId }}</p>
        <p><strong>Log Time:</strong> {{ printMatableData.LogTime | date:'medium' }}</p>
        <div *ngIf="printMatableData.ImagePaths?.length">
          <p><strong>Images:</strong></p>
          <img *ngFor="let img of printMatableData.ImagePaths" [src]="img" style="max-width: 100px; margin: 5px;" />
        </div>
      </div>

      <!-- Edit Modal -->
      <div class="modal" tabindex="-1" [ngClass]="{ 'show d-block': isEditModalVisible }" *ngIf="isEditModalVisible">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Matable</h5>
              <button type="button" class="btn-close" (click)="closeEditModal()"></button>
            </div>
            <div class="modal-body" *ngIf="selectedMatable">
              <form>
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" [(ngModel)]="selectedMatable.Name" name="name" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" [(ngModel)]="selectedMatable.Description" name="description"></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Status</label>
                  <select class="form-select" [(ngModel)]="selectedMatable.StatusName" name="statusName">
                    <option value="Pending">Pending</option>
                    <option value="Work In Progress">Work In Progress</option>
                    <option value="Solved">Solved</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Tenant Code</label>
                  <input type="text" class="form-control" [(ngModel)]="selectedMatable.TenantCode" name="tenantCode" />
                </div>
                <div class="mb-3">
                  <label class="form-label">User ID</label>
                  <input type="number" class="form-control" [(ngModel)]="selectedMatable.UserId" name="userId" readonly />
                </div>
                <div class="mb-3">
                  <label class="form-label">Image</label>
                  <app-fileip (imageSelected)="onImageSelected($event)"></app-fileip>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
              <button class="btn btn-primary" (click)="saveChanges()">Save changes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination d-flex justify-content-center align-items-center mt-3 gap-3">
  <button class="btn btn-outline-primary" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
    Previous
  </button>

  <span>Page {{ currentPage }} of {{ totalPages }}</span>

  <button class="btn btn-outline-primary" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
    Next
  </button>
</div>

    </div>
  </div>
</div>
